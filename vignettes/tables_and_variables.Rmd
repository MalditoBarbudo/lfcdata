---
title: "Tables and variables"
output:
  rmarkdown::html_vignette:
    toc: true
vignette: >
  %\VignetteIndexEntry{Tables and variables}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(lfcdata)
```

## NFI database

### Tables available

Tables available to get data from can be consulted this way:

```{r avail_table}
nfidb <- nfi()
nfi_avail_tables(nfidb)
```

### Table naming conventions

Plots info:

  - `plots`: main table containing the *static-in-time* information about plots.  
  - `plots_nfi_X_dynamic_info`: tables containing the *dynamic-in-time* information about
    plots for each nfi version

Plot level results:

  - `plot_nfi_X_[diamclass]_results`: tables with the data for the `X` nfi version.  
      + `diamclass` indicates plot data broken down by diameter classes.  
  - `plot_comp_nfiX_nfiY_[diamclass]_results`: tables with the data for nfi `X` and `Y`
    versions comparisions.  
      + `diamclass` indicates plot data broken down by diameter classes.

Functional group broken down results:

  - `[fg]_nfi_X_[diamclass]_results`: tables with the data for the `X` nfi version, broken
    down by functional group value.  
      + `diamclass` indicates data broken down by diameter classes.  
      + `fg` can be `species`, `genus`, `simpspecies` (simplified list of species, with
        some of them grouped), `dec` (**d**eciduous - **e**sclerophyll - **c**onifer) and
        `bc` (**b**roadleaves - **c**onifer)  
  - `[fg]_comp_nfiX_nfiY_[diamclass]_results`: tables with the data for nfi `X` and `Y`
    versions comparisions, broken down by functional group value.  
      + `diamclass` indicates data broken down by diameter classes.  
      + `fg` can be `species`, `genus`, `simpspecies` (simplified list of species, with
        some of them grouped), `dec` (**d**eciduous - **e**sclerophyll - **c**onifer) and
        `bc` (**b**roadleaves - **c**onifer)  

Other tables:

  - `regeneration_nfi_X`: regeneration (small trees) tables for `X` nfi version. These
    tables are **always broken down by species**.  
  - `shrub_nfi_X_info`: Shrubs information tables for `X` nfi version. These
    tables are **always broken down by species**.
    

Description of a table can be obtained with `nif_describe_table` function:

```{r}
nfi_describe_table(nfidb, 'plot_nfi_4_results')
```


### Variables info

Information about variables can be consulted in console:

```{r var_info}
nfi_describe_var(nfidb, c('density', 'basal_area'))
```

#### Complete list of NFI variables

```{r var_info_complete, echo = FALSE, comment = ''}
nfi_get_data(nfidb, 'variables_thesaurus') %>%
  dplyr::pull(var_id) %>%
  unique() %>% 
  sort() %>% {
    for (var in .) {
      nfi_describe_var(nfidb, var)
      cat('----------------\n\n')
    }
  }
```

## Allometries

### Tables available

Allometries database only offers one table, `allometries`. This table contains all the
allometries and their information:

```{r allometries}
allomdb <- allometries()
allometries_get_data(allomdb)
```

### Variables info

Information about variables can be consulted in console:

```{r}
allometries_describe_var(allomdb, 'param_a')
```

It also can be used to describe in detail the independent and dependent variables:

```{r}
allometries_describe_var(allomdb, c('DR', 'DBH'))
```


## LiDAR

### Tables available

LiDAR database offers raster tables (in the form of `stars` or `raster` objects).
Available rasters can be consulted:

```{r lidar_avail}
lidardb <- lidar()
lidar_avail_tables(lidardb)
```

### Variables info

Table names correspond to the variable stored in the raster, you can access the detailed
information about the variable:

```{r lidar_describe}
lidar_describe_var(lidardb, 'AB')
```

#### Complete list of LiDAR variables

```{r lidar_complete, echo = FALSE}
lidar_describe_var(lidardb, c('AB', 'BAT', 'BF', 'CAT', 'DBH', 'HM', 'REC', 'VAE'))
```

